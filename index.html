<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Guinness in Reykjavík</title>

  <!-- Leaflet (map library) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <style>
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    #map { height: 100vh; }
    .panel {
      position: absolute; z-index: 1000; top: 12px; left: 12px;
      background: white; padding: 10px 12px; border-radius: 12px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.12);
      max-width: 340px;
    }
    .panel button { margin-right: 8px; }
    .muted { color: #555; font-size: 13px; line-height: 1.35; }
    .row { margin-top: 8px; }
    .badge { display:inline-block; padding: 2px 8px; border-radius: 999px; background:#f2f2f2; font-size: 12px; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="panel">
    <div><strong>Guinness in Reykjavík</strong> <span class="badge">MVP</span></div>
    <div class="muted">
      Add places in the <code>places</code> list. Click “Locate me” to find the nearest.
    </div>
    <div class="row">
      <button id="locateBtn">Locate me</button>
      <button id="nearestBtn" disabled>Nearest Guinness</button>
    </div>
    <div class="row muted" id="status">Tip: open this on your phone and allow location access.</div>
  </div>

  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script>
    // 1) Put your Guinness places here (name + lat/lng)
    // Find coords quickly by right-clicking in Google Maps / OSM, or by searching the venue and copying.
    const places = [
  { name: "Bjórgarðurinn (Fosshotel Reykjavík)", lat: 64.1443921, lng: -21.9095837, note: "Inside Fosshotel (Þórunnartún 1)" },
  { name: "Tivoli Bar", lat: 64.1481387, lng: -21.9396630, note: "Check it's open" },
  { name: "The Irishman Pub", lat: 64.1460600, lng: -21.9288000, note: "Klapparstígur 27" },
  { name: "The English Pub", lat: 64.1475600, lng: -21.9391900, note: "Austurstræti 12" },
  { name: "American Bar", lat: 64.1477377, lng: -21.9400835, note: "Austurstræti area" },
  { name: "Den Danske Kro", lat: 64.1463800, lng: -21.9336600, note: "" },
  { name: "Kaffibarinn", lat: 64.1459583, lng: -21.9313250, note: "Bergstaðastræti" },
  { name: "Bastard Brew & Food", lat: 64.1456700, lng: -21.9307540, note: "Vegamótastígur 4" },
  { name: "The Drunk Rabbit", lat: 64.1479790, lng: -21.9402900, note: "Austurstræti 3" },
  { name: "Veður Bar & Café", lat: 64.14554, lng: -21.92923, note: "Wine, beer & cocktails (Klapparstígur 33)" },
    ];

    // Reykjavík center
    const map = L.map("map").setView([64.1466, -21.9426], 13);

    // Free OpenStreetMap tiles
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const markersLayer = L.layerGroup().addTo(map);
    const routeLayer = L.layerGroup().addTo(map);

    function renderPlaces() {
      markersLayer.clearLayers();
      places.forEach(p => {
        const m = L.marker([p.lat, p.lng]).addTo(markersLayer);
        m.bindPopup(`<strong>${p.name}</strong>${p.note ? `<br/><span class="muted">${p.note}</span>` : ""}`);
      });
    }
    renderPlaces();

    // User location
    let userMarker = null;
    let userLatLng = null;

    const statusEl = document.getElementById("status");
    const locateBtn = document.getElementById("locateBtn");
    const nearestBtn = document.getElementById("nearestBtn");

    function haversineMeters(a, b) {
      const R = 6371000;
      const toRad = d => (d * Math.PI) / 180;
      const dLat = toRad(b.lat - a.lat);
      const dLng = toRad(b.lng - a.lng);
      const lat1 = toRad(a.lat);
      const lat2 = toRad(b.lat);
      const x = Math.sin(dLat/2)**2 + Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLng/2)**2;
      return 2 * R * Math.asin(Math.sqrt(x));
    }

    // Rough walking time: assume 4.8 km/h (80 m/min)
    function walkingMinutesFromMeters(m) {
      return Math.round(m / 80);
    }

    function findNearestPlace() {
      if (!userLatLng) return null;
      if (!places.length) return null;

      let best = null;
      for (const p of places) {
        const d = haversineMeters(userLatLng, { lat: p.lat, lng: p.lng });
        if (!best || d < best.distanceMeters) {
          best = { place: p, distanceMeters: d };
        }
      }
      return best;
    }

    function drawSimpleLine(toPlace) {
      routeLayer.clearLayers();
      const line = L.polyline([userLatLng, [toPlace.lat, toPlace.lng]], { weight: 5, opacity: 0.8 });
      line.addTo(routeLayer);
      map.fitBounds(line.getBounds(), { padding: [40, 40] });
    }

    locateBtn.addEventListener("click", () => {
      if (!navigator.geolocation) {
        statusEl.textContent = "Geolocation not supported in this browser.";
        return;
      }
      statusEl.textContent = "Locating…";
      navigator.geolocation.getCurrentPosition(
        pos => {
          userLatLng = { lat: pos.coords.latitude, lng: pos.coords.longitude };
          if (userMarker) userMarker.remove();
          userMarker = L.circleMarker([userLatLng.lat, userLatLng.lng], { radius: 8 }).addTo(map);
          userMarker.bindPopup("<strong>You are here</strong>").openPopup();
          map.setView([userLatLng.lat, userLatLng.lng], 15);
          nearestBtn.disabled = false;
          statusEl.textContent = "Location found. Tap “Nearest Guinness”.";
        },
        err => {
          statusEl.textContent = "Could not get location. Make sure you allowed location access.";
          console.warn(err);
        },
        { enableHighAccuracy: true, timeout: 10000 }
      );
    });

    nearestBtn.addEventListener("click", () => {
      routeLayer.clearLayers();
      const nearest = findNearestPlace();
      if (!nearest) {
        statusEl.textContent = places.length
          ? "No location yet—tap “Locate me” first."
          : "No places yet—add them to the places list in the code.";
        return;
      }

      const mins = walkingMinutesFromMeters(nearest.distanceMeters);
      const km = (nearest.distanceMeters / 1000).toFixed(2);

      drawSimpleLine(nearest.place);

      statusEl.innerHTML =
        `Nearest: <strong>${nearest.place.name}</strong> — ~${mins} min walk (${km} km as-the-crow-flies). ` +
        `Click its pin for details.`;
    });
  </script>
</body>
</html>