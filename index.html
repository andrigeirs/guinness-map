<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Guinness in Reykjavík</title>

<link rel="stylesheet"
href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body{margin:0;font-family:system-ui}
#map{height:100vh;position:relative}

/* panel */
.panel{
position:absolute;
z-index:1000;
top:12px;
left:12px;
right:12px;
max-width:560px;
background:#0b0b0b;
color:#f7f2e7;
padding:12px 14px;
border-radius:14px;
box-shadow:0 10px 35px rgba(0,0,0,.35);
border:1px solid rgba(211,163,74,.35)
}
.muted{color:rgba(247,242,231,.75);font-size:13px}
.row{margin-top:8px;display:flex;flex-wrap:wrap;gap:8px}
.badge{
padding:2px 8px;
border-radius:999px;
background:rgba(211,163,74,.18);
color:#d3a34a;
font-size:12px;
margin-left:6px
}
button{
background:#d3a34a;
color:#0b0b0b;
border:none;
padding:8px 10px;
border-radius:10px;
cursor:pointer;
font-weight:800
}
button.secondary{
background:rgba(211,163,74,.18);
color:#f7f2e7;
border:1px solid rgba(211,163,74,.35)
}
button:disabled{opacity:.5}

/* marker glow */
@keyframes pulse{
0%{filter:drop-shadow(0 0 0 rgba(212,175,55,0))}
50%{filter:drop-shadow(0 0 14px rgba(212,175,55,.9))}
100%{filter:drop-shadow(0 0 0 rgba(212,175,55,0))}
}
.nearest-glow{animation:pulse 1.4s infinite}
.gold-route{filter:drop-shadow(0 0 6px rgba(212,175,55,.7))}

/* ================= MAP EFFECT ================= */

.leaflet-tile{
filter:
brightness(1.3)
contrast(1.15)
saturate(.9)
hue-rotate(205deg);
}

.leaflet-pane{z-index:200}

/* navy tone */
#map::before{
content:"";
position:absolute;
inset:0;
pointer-events:none;
z-index:300;
background:#020035;
opacity:.22;
mix-blend-mode:multiply;
}

/* glow */
#map::after{
content:"";
position:absolute;
inset:0;
pointer-events:none;
z-index:301;
background:
radial-gradient(circle at 40% 60%,rgba(0,140,255,.18),transparent 60%),
radial-gradient(circle at 70% 30%,rgba(0,110,255,.16),transparent 65%),
radial-gradient(circle at 30% 80%,rgba(0,160,255,.14),transparent 70%);
mix-blend-mode:screen;
}

/* particles */
.leaflet-container::after{
content:"";
position:absolute;
inset:0;
pointer-events:none;
z-index:302;
background-image:
radial-gradient(circle,rgba(120,170,255,.35)1px,transparent 2px),
radial-gradient(circle,rgba(60,120,255,.25)1px,transparent 2px),
radial-gradient(circle,rgba(200,220,255,.18)1px,transparent 2px);
background-size:120px 120px,180px 180px,260px 260px;
animation:drift 80s linear infinite
}
@keyframes drift{
from{background-position:0 0,0 0,0 0}
to{background-position:800px 400px,-600px 300px,400px -700px}
}
</style>
</head>

<body>
<div id="map"></div>

<div class="panel">
<strong>Guinness in Reykjavík</strong>
<span class="badge">Wheel + Crawl + Heat</span>

<div class="muted">
Locate yourself → nearest pint, spin wheel, crawl, or heatmap.
</div>

<div class="row">
<button id="locateBtn">Locate me</button>
<button id="nearestBtn" disabled>Nearest</button>
<button id="spinBtn" class="secondary">Wheel</button>
<button id="crawlBtn" class="secondary">Crawl</button>
<button id="heatBtn" class="secondary">Heat</button>
<button id="clearBtn" class="secondary">Clear</button>
</div>

<div class="row muted" id="status">
Tip: allow location for directions.
</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>

<script>
const places=[
{name:"Ölstofan",lat:64.14561,lng:-21.93103},
{name:"Litli Dubliner",lat:64.14517,lng:-21.92462},
{name:"The Dubliner",lat:64.14864,lng:-21.94028},
{name:"Kaffibarinn",lat:64.1459583,lng:-21.931325},
{name:"Bastard",lat:64.14567,lng:-21.930754},
{name:"English Pub",lat:64.14756,lng:-21.93919}
];

const map=L.map("map").setView([64.1466,-21.9426],13);

L.tileLayer(
"https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png",
{maxZoom:19}).addTo(map);

const icon=L.icon({
iconUrl:"./guinness.png",
iconSize:[44,44],
iconAnchor:[22,44]
});

const layer=L.layerGroup().addTo(map);
const route=L.layerGroup().addTo(map);

let user=null;
let heat=null;

function draw(){
layer.clearLayers();
places.forEach(p=>{
const m=L.marker([p.lat,p.lng],{icon}).addTo(layer);
m.bindPopup(`<b>${p.name}</b><br>
<a target=_blank href="https://maps.google.com/?daddr=${p.lat},${p.lng}">Directions</a>`);
});
}
draw();

function dist(a,b){
const R=6371e3;
const toRad=d=>d*Math.PI/180;
const dLat=toRad(b.lat-a.lat);
const dLng=toRad(b.lng-a.lng);
const x=Math.sin(dLat/2)**2+
Math.cos(toRad(a.lat))*Math.cos(toRad(b.lat))*Math.sin(dLng/2)**2;
return 2*R*Math.asin(Math.sqrt(x));
}

document.getElementById("locateBtn").onclick=()=>{
navigator.geolocation.getCurrentPosition(p=>{
user={lat:p.coords.latitude,lng:p.coords.longitude};
L.circleMarker([user.lat,user.lng]).addTo(map);
map.setView([user.lat,user.lng],15);
document.getElementById("nearestBtn").disabled=false;
});
};

document.getElementById("nearestBtn").onclick=()=>{
let best=null;
places.forEach(p=>{
const d=dist(user,p);
if(!best||d<best.d)best={p,d};
});
route.clearLayers();
L.polyline([[user.lat,user.lng],[best.p.lat,best.p.lng]],
{color:"#D4AF37",weight:6}).addTo(route);
};

document.getElementById("heatBtn").onclick=()=>{
if(heat){map.removeLayer(heat);heat=null;return;}
heat=L.heatLayer(places.map(p=>[p.lat,p.lng,.8]),{radius:35});
heat.addTo(map);
};

document.getElementById("clearBtn").onclick=()=>{
route.clearLayers();
if(heat){map.removeLayer(heat);heat=null;}
};
</script>
</body>
</html>